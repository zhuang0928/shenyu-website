<!doctype html><html><head><title>Custom Plugin · ShenYu</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link style=font-size:25px;margin-right:50px href=/><img class=logo src=/img/logo/apache-shenyu.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/shenyu/download/><span>Download</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/shenyu/overview/><span>Documentation</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome ShenYu</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/shenyu-2.3.0/custom-plugin/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/shenyu/download/>Download</a>
<a class=navbar-item href=/projects/shenyu/overview/>Documentation</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/community/>Community</a>
<a class=navbar-item href=/awesome/>Awesome ShenYu</a>
<span class="navbar-item nav-hover"><a>Links</a><div class=dropdown-menu><a class=dropdown-item href=https://www.apache.org/>Apache Software Foundation</a>
<a class=dropdown-item href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=dropdown-item href=https://www.apache.org/>License</a>
<a class=dropdown-item href=http://www.apache.org/events/current-event>Apache Events</a>
<a class=dropdown-item href=https://www.apache.org/licenses/>Security</a>
<a class=dropdown-item href=http://www.apache.org/foundation/sponsorship.html>Sponsor and Donate</a>
<a class=dropdown-item href=http://www.apache.org/foundation/thanks.html>Thanks</a></div></span></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/projects/shenyu-2.3.0/custom-plugin/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Custom Plugin</h1><a class="edit-button -hidden-mobile" href=https://github.com/apache/incubator-shenyu-website/edit/main/content/en/projects/shenyu-2.3.0/custom-plugin/index.md>Edit</a></div><div class=meta>Update time: 2021-06-24</div></div><article class=typo><h2 id=description>Description</h2><ul><li>Plugins are core executors of soul gateway. Every plugin handles matched requests when enabled.</li><li>There are two kinds of plugins in the soul gateway.</li><li>The first type is a call chain with a single responsibility, and traffic cannot be customized.</li><li>The other one can do its own chain of responsibility for matched traffic.</li><li>You could reference from soul-plugin module and develop plugins by yourself. Please fire pull requests of your wonderful plugins without hesitate.</li></ul><h2 id=single-responsibility-plugins>Single Responsibility Plugins</h2><ul><li><p>Add following dependency:</p><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.dromara&lt;/groupId&gt;
    &lt;artifactId&gt;soul-plugin-api&lt;/artifactId&gt;
    &lt;version&gt;${last.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></li><li><p>Declare a new class named &ldquo;A&rdquo; and implements <code>org.dromara.soul.plugin.api.SoulPlugin</code></p></li></ul><pre><code class=language-java>public interface SoulPlugin {
    
    /**
     * Process the Web request and (optionally) delegate to the next
     * {@code WebFilter} through the given {@link SoulPluginChain}.
     *
     * @param exchange the current server exchange
     * @param chain    provides a way to delegate to the next filter
     * @return {@code Mono&lt;Void&gt;} to indicate when request processing is complete
     */
    Mono&lt;Void&gt; execute(ServerWebExchange exchange, SoulPluginChain chain);
    
    /**
     * return plugin order .
     * This attribute To determine the plugin execution order in the same type plugin.
     *
     * @return int order
     */
    int getOrder();
    
    /**
     * acquire plugin name.
     * this is plugin name define you must offer the right name.
     * if you impl AbstractSoulPlugin this attribute not use.
     *
     * @return plugin name.
     */
    default String named() {
        return &quot;&quot;;
    }
    
    /**
     * plugin is execute.
     * if return true this plugin can not execute.
     *
     * @param exchange the current server exchange
     * @return default false.
     */
    default Boolean skip(ServerWebExchange exchange) {
        return false;
    }
}

</code></pre><p>Detailed instruction of interface methods:</p><ul><li><code>execute()</code> core method, you can do any task here freely.</li><li><code>getOrder()</code> get the order of current plugin.</li><li><code>named()</code> acquire the name of specific plugin.</li><li><code>skip()</code> determines whether this plugin should be skipped under certain conditions.</li><li>Register plugin in Spring as a Bean, or simply apply <code>@Component</code> in implementation class.</li></ul><pre><code class=language-java>    @Bean
    public SoulPlugin a() {
        return new A();
    }
</code></pre><h2 id=matching-traffic-processing-plugin>Matching Traffic Processing Plugin</h2><ul><li><p>Introduce the following dependency:</p><pre><code class=language-xml>&lt;dependency&gt;
    &lt;groupId&gt;org.dromara&lt;/groupId&gt;
    &lt;artifactId&gt;soul-plugin-base&lt;/artifactId&gt;
    &lt;version&gt;${last.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul><li><p>Add a new class A, inherit from <code>org.dromara.soul.plugin.base.AbstractSoulPlugin</code></p></li><li><p>examples down below:</p></li></ul><pre><code class=language-java>/**
* This is your custom plugin.
* He is running in after before plugin, implement your own functionality.
* extends AbstractSoulPlugin so you must user soul-admin And add related plug-in development.
*
* @author xiaoyu(Myth)
*/
public class CustomPlugin extends AbstractSoulPlugin {
    
/**
 * return plugin order .
 * The same plugin he executes in the same order.
 *
 * @return int
 */
@Override
public int getOrder() {
    return 0;
}

/**
 * acquire plugin name.
 * return you custom plugin name.
 * It must be the same name as the plug-in you added in the admin background.
 *
 * @return plugin name.
 */
@Override
public String named() {
    return &quot;soul&quot;;
}

/**
 * plugin is execute.
 * Do I need to skip.
 * if you need skip return true.
 *
 * @param exchange the current server exchange
 * @return default false.
 */
@Override
public Boolean skip(final ServerWebExchange exchange) {
    return false;
}

@Override
protected Mono&lt;Void&gt; doExecute(ServerWebExchange exchange, SoulPluginChain chain, SelectorZkDTO selector, RuleZkDTO rule) {
    LOGGER.debug(&quot;.......... function plugin start..............&quot;);
    /*
     * Processing after your selector matches the rule.
     * rule.getHandle() is you Customize the json string to be processed.
     * for this example.
     * Convert your custom json string pass to an entity class.
     */
    final String ruleHandle = rule.getHandle();

    final Test test = GsonUtils.getInstance().fromJson(ruleHandle, Test.class);

    /*
     * Then do your own business processing.
     * The last execution  chain.execute(exchange).
     * Let it continue on the chain until the end.
     */
    System.out.println(test.toString());
    return chain.execute(exchange);
}
}

</code></pre></li><li><p>Detailed explanation:</p><ul><li><p>Plugins will match the selector rule for customized plugins inherit from this abstract class. Following steps guide you to config your plugins.</p></li><li><p>Firstly define a new plugin in <code>soul-admin</code>, please mind that your plugin name should match the named() method overridden in your class.</p></li><li><p>Re-login <code>soul-admin</code>, the plugin you added now showing on plugin-list page, you can choose selectors for matching.</p></li><li><p>There is a field named <code>handler</code> in rules, it is customized json string to be processed. You can process data after acquiring a ruleHandle (<code>final String ruleHandle = rule.getHandle();</code>) in <code>doExecute()</code> method.</p></li></ul></li><li><p>Register plugin in Spring as a Bean, or simply apply <code>@Component</code> in implementation class.</p></li></ul><pre><code class=language-java>    @Bean
    public SoulPlugin a() {
        return new A();
    }
</code></pre><h2 id=subscribe-your-plugin-data-and-do-customized-jobs>Subscribe your plugin data and do customized jobs</h2><ul><li>Declare a new class named &ldquo;A&rdquo; and implements <code>org.dromara.soul.plugin.base.handler.PluginDataHandler</code></li></ul><pre><code class=language-java>public interface PluginDataHandler {
    
    /**
     * Handler plugin.
     *
     * @param pluginData the plugin data
     */
    default void handlerPlugin(PluginData pluginData) {
    }
    
    /**
     * Remove plugin.
     *
     * @param pluginData the plugin data
     */
    default void removePlugin(PluginData pluginData) {
    }
    
    /**
     * Handler selector.
     *
     * @param selectorData the selector data
     */
    default void handlerSelector(SelectorData selectorData) {
    }
    
    /**
     * Remove selector.
     *
     * @param selectorData the selector data
     */
    default void removeSelector(SelectorData selectorData) {
    }
    
    /**
     * Handler rule.
     *
     * @param ruleData the rule data
     */
    default void handlerRule(RuleData ruleData) {
    }
    
    /**
     * Remove rule.
     *
     * @param ruleData the rule data
     */
    default void removeRule(RuleData ruleData) {
    }
    
    /**
     * Plugin named string.
     *
     * @return the string
     */
    String pluginNamed();
    
}
</code></pre><ul><li>Ensure <code>pluginNamed()</code> is same as the plugin name you defined.</li><li><p>Register defined class as a Spring Bean, or simply apply <code>@Component</code> in implementation class.</p><pre><code class=language-java>@Bean
public PluginDataHandler a() {
    return new A();
}
</code></pre><h2 id=do-not-use-selectorlist-and-ruleslist>Do not use SelectorList and RulesList</h2><p>Not all plugins need both.</p><p>Therefore, we provide the following two methods, written in <strong>CustomPlugin</strong>.</p><pre><code class=language-java>@Override
protected Mono&lt;Void&gt; handleSelectorIsNull(final String pluginName, 
                                          final ServerWebExchange exchange, 
                                          final SoulPluginChain chain) {
    return doExecute(exchange, chain, null, null);
}

@Override
protected Mono&lt;Void&gt; handleRuleIsNull(final String pluginName, 
                                      final ServerWebExchange exchange, 
                                      final SoulPluginChain chain) {
    return doExecute(exchange, chain, null, null);
}
</code></pre></li><li><p>Note that if there is no rewriting, your plug-in will be invalid due to the absence of <strong>SelectorList</strong> and <strong>RulesList</strong>.</p></li></ul></article></main></div><footer class=ss-footer><div class=container><div class=links><div class="cate  -show-mobile"><h2 class=cate-title>Apache</h2><a class=link href=https://www.apache.org/>Foundation</a>
<a class=link href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=link href=https://www.apache.org/licenses/>License</a>
<a class=link href=https://www.apache.org/security/>Security</a>
<a class=link href=http://www.apache.org/events/current-event>Events</a>
<a class=link href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
<a class=link href=http://www.apache.org/foundation/thanks.html>Thanks</a></div><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/apache/incubator-shenyu>Github</a>
<a class=link href=/projects/shenyu/overview/>Documentation</a>
<a class=link href=mailto://dev-subscribe@shenyu.apache.org>Subscribe Mail</a>
<a class=link href=https://lists.apache.org/list.html?dev@shenyu.apache.org>Mail Archive</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/apache/incubator-shenyu/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div></div></div><div class=copyright><p>Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.
Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache EventMesh logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.
Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator.
Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects.
While incubation status is not necessarily a reflection of the completeness or stability of the code,
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></footer></body></html>
<!doctype html><html><head><title>Data Synchronization Design · Apache ShenYu</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link style=font-size:25px;margin-right:50px href=/><img class=logo src=/img/logo/apache-shenyu.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/shenyu/download/><span>Download</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/shenyu/overview/><span>Documentation</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/subscribe-email/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/news/><span>News</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/shenyu/data-sync/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class=navbar-menu><div class=navbar-start><a class=navbar-item href=/projects/shenyu/download/>Download</a>
<span class="navbar-item nav-hover document-menu"><a>Documentation</a><div class=dropdown-menu><a class=dropdown-item href=/projects/shenyu/overview>current</a>
<a class=dropdown-item href=/projects/shenyu-2.3.0/overview>2.3.0</a></div></span><a class=navbar-item href=/community/subscribe-email/>Community</a>
<a class=navbar-item href=/news/>News</a>
<span class="navbar-item nav-hover"><a>Links</a><div class=dropdown-menu><a class=dropdown-item href=https://www.apache.org/>Apache Software Foundation</a>
<a class=dropdown-item href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=dropdown-item href=https://www.apache.org/>License</a>
<a class=dropdown-item href=http://www.apache.org/events/current-event>Apache Events</a>
<a class=dropdown-item href=https://www.apache.org/licenses/>Security</a>
<a class=dropdown-item href=http://www.apache.org/foundation/sponsorship.html>Sponsor and Donate</a>
<a class=dropdown-item href=http://www.apache.org/foundation/thanks.html>Thanks</a></div></span></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/projects/shenyu/data-sync/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="This is an asynchronous, high-performance, cross-language, responsive API gateway.">Apache ShenYu(current)</div><div class=body><ul class=leaf-section><li class=item><div class=link><a title=Overview href=/projects/shenyu/overview>Overview</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Design>Design</a></div><ul class=leaf-section><li class=item><div class=link><a title="Admin Database Design" href=/projects/shenyu/database-design>Admin Database Design</a></div></li><li class=item><div class="link -current"><a title="Data Synchronization" href=/projects/shenyu/data-sync>Data Synchronization</a></div></li><li class=item><div class=link><a title="Application Client Access" href=/projects/shenyu/register-center-design>Application Client Access</a></div></li><li class=item><div class=link><a title="Flow Control" href=/projects/shenyu/flow-control>Flow Control</a></div></li><li class=item><div class=link><a title="SPI Design" href=/projects/shenyu/spi-design>SPI Design</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Deployment>Deployment</a></div><ul class=leaf-section><li class=item><div class=link><a title="Local Deployment" href=/projects/shenyu/deployment-local>Local Deployment</a></div></li><li class=item><div class=link><a title="Binary Packages Deployment" href=/projects/shenyu/deployment-package>Binary Packages Deployment</a></div></li><li class=item><div class=link><a title="Docker Deployment" href=/projects/shenyu/deployment-docker>Docker Deployment</a></div></li><li class=item><div class=link><a title="Kubernetes Deployment" href=/projects/shenyu/deployment-k8s>Kubernetes Deployment</a></div></li><li class=item><div class=link><a title="Helm Deployment" href=/projects/shenyu/deployment-helm>Helm Deployment</a></div></li><li class=item><div class=link><a title="Custom Deployment" href=/projects/shenyu/deployment-custom>Custom Deployment</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Quick Start">Quick Start</a></div><ul class=leaf-section><li class=item><div class=link><a title="Http Proxy" href=/projects/shenyu/quick-start-http>Http Proxy</a></div></li><li class=item><div class=link><a title="Dubbo Proxy" href=/projects/shenyu/quick-start-dubbo>Dubbo Proxy</a></div></li><li class=item><div class=link><a title="Spring Cloud Proxy" href=/projects/shenyu/quick-start-springcloud>Spring Cloud Proxy</a></div></li><li class=item><div class=link><a title="Sofa Proxy" href=/projects/shenyu/quick-start-sofa>Sofa Proxy</a></div></li><li class=item><div class=link><a title="gRPC Proxy" href=/projects/shenyu/quick-start-grpc>gRPC Proxy</a></div></li><li class=item><div class=link><a title="Tars Proxy" href=/projects/shenyu/quick-start-tars>Tars Proxy</a></div></li><li class=item><div class=link><a title="Motan Proxy" href=/projects/shenyu/quick-start-motan>Motan Proxy</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="User Guide">User Guide</a></div><ul class=leaf-section><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Admin Usage">Admin Usage</a></div><ul class=leaf-section><li class=item><div class=link><a title="Plugin Config" href=/projects/shenyu/plugin-handle-explanation>Plugin Config</a></div></li><li class=item><div class=link><a title="Selector And Rule Config" href=/projects/shenyu/selector-and-rule>Selector And Rule Config</a></div></li><li class=item><div class=link><a title="Dictionary Management" href=/projects/shenyu/dictionary-management>Dictionary Management</a></div></li><li class=item><div class=link><a title="Authority Management" href=/projects/shenyu/authority-management>Authority Management</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Property Config">Property Config</a></div><ul class=leaf-section><li class=item><div class=link><a title="Admin Property Config" href=/projects/shenyu/admin-property-config>Admin Property Config</a></div></li></ul></li><li class=item><div class=link><a title="Data Synchronization Config" href=/projects/shenyu/use-data-sync>Data Synchronization Config</a></div></li><li class=item><div class=link><a title="Application Client Access Config" href=/projects/shenyu/register-center-access>Application Client Access Config</a></div></li><li class=item><div class=link><a title="Http Proxy" href=/projects/shenyu/http-proxy>Http Proxy</a></div></li><li class=item><div class=link><a title="Dubbo Proxy" href=/projects/shenyu/dubbo-proxy>Dubbo Proxy</a></div></li><li class=item><div class=link><a title="Spring Cloud Proxy" href=/projects/shenyu/spring-cloud-proxy>Spring Cloud Proxy</a></div></li><li class=item><div class=link><a title="Sofa Proxy" href=/projects/shenyu/sofa-rpc-proxy>Sofa Proxy</a></div></li><li class=item><div class=link><a title="gRPC Proxy" href=/projects/shenyu/grpc-proxy>gRPC Proxy</a></div></li><li class=item><div class=link><a title="Tars Proxy" href=/projects/shenyu/tars-proxy>Tars Proxy</a></div></li><li class=item><div class=link><a title="Motan Proxy" href=/projects/shenyu/motan-proxy>Motan Proxy</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Plugin Center">Plugin Center</a></div><ul class=leaf-section><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Http Handle">Http Handle</a></div><ul class=leaf-section><li class=item><div class=link><a title="Rewrite Plugin" href=/projects/shenyu/rewrite-plugin>Rewrite Plugin</a></div></li><li class=item><div class=link><a title="Redirect Plugin" href=/projects/shenyu/redirect-plugin>Redirect Plugin</a></div></li><li class=item><div class=link><a title="Request Plugin" href=/projects/shenyu/request-plugin>Request Plugin</a></div></li><li class=item><div class=link><a title="Context-path Plugin" href=/projects/shenyu/context-path-plugin>Context-path Plugin</a></div></li><li class=item><div class=link><a title="Param-mapping Plugin" href=/projects/shenyu/param-mapping-plugin>Param-mapping Plugin</a></div></li><li class=item><div class=link><a title="ModifyResponse Plugin" href=/projects/shenyu/modify-response-plugin>ModifyResponse Plugin</a></div></li><li class=item><div class=link><a title="WebSocket Proxy" href=/projects/shenyu/websocket-plugin>WebSocket Proxy</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="RPC Proxy">RPC Proxy</a></div><ul class=leaf-section><li class=item><div class=link><a title="Divide Plugin" href=/projects/shenyu/divide-plugin>Divide Plugin</a></div></li><li class=item><div class=link><a title="Dubbo Plugin" href=/projects/shenyu/dubbo-plugin>Dubbo Plugin</a></div></li><li class=item><div class=link><a title="Spring Cloud Plugin" href=/projects/shenyu/spring-cloud-plugin>Spring Cloud Plugin</a></div></li><li class=item><div class=link><a title="Sofa Plugin" href=/projects/shenyu/sofa-plugin>Sofa Plugin</a></div></li><li class=item><div class=link><a title="gRPC Plugin" href=/projects/shenyu/grpc-plugin>gRPC Plugin</a></div></li><li class=item><div class=link><a title="Tars Plugin" href=/projects/shenyu/tars-plugin>Tars Plugin</a></div></li><li class=item><div class=link><a title="Motan Plugin" href=/projects/shenyu/motan-plugin>Motan Plugin</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Fault Tolerance">Fault Tolerance</a></div><ul class=leaf-section><li class=item><div class=link><a title="Hystrix Plugin" href=/projects/shenyu/hystrix-plugin>Hystrix Plugin</a></div></li><li class=item><div class=link><a title="Sentinel Plugin" href=/projects/shenyu/sentinel-plugin>Sentinel Plugin</a></div></li><li class=item><div class=link><a title="Resilience4j Plugin" href=/projects/shenyu/resilience4j-plugin>Resilience4j Plugin</a></div></li><li class=item><div class=link><a title="RateLimiter Plugin" href=/projects/shenyu/rate-limiter-plugin>RateLimiter Plugin</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Authority And Certification">Authority And Certification</a></div><ul class=leaf-section><li class=item><div class=link><a title="Waf Plugin" href=/projects/shenyu/waf-plugin>Waf Plugin</a></div></li><li class=item><div class=link><a title="Sign Plugin" href=/projects/shenyu/sign-plugin>Sign Plugin</a></div></li><li class=item><div class=link><a title="JWT Plugin" href=/projects/shenyu/jwt-plugin>JWT Plugin</a></div></li><li class=item><div class=link><a title="OAuth 2 Plugin" href=/projects/shenyu/oauth2-plugin>OAuth 2 Plugin</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Observability>Observability</a></div><ul class=leaf-section><li class=item><div class=link><a title="Monitor Plugin" href=/projects/shenyu/monitor-plugin>Monitor Plugin</a></div></li><li class=item><div class=link><a title="Logging Plugin" href=/projects/shenyu/logging-plugin>Logging Plugin</a></div></li></ul></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Developer Documentation">Developer Documentation</a></div><ul class=leaf-section><li class=item><div class=link><a title="Custom Filter" href=/projects/shenyu/custom-filter>Custom Filter</a></div></li><li class=item><div class=link><a title="Custom Plugin" href=/projects/shenyu/custom-plugin>Custom Plugin</a></div></li><li class=item><div class=link><a title="File Upload And Download" href=/projects/shenyu/file-and-image>File Upload And Download</a></div></li><li class=item><div class=link><a title="Custom Parsing IP And Host" href=/projects/shenyu/custom-parsing-ip-and-host>Custom Parsing IP And Host</a></div></li><li class=item><div class=link><a title="Custom Result" href=/projects/shenyu/custom-result>Custom Result</a></div></li><li class=item><div class=link><a title="Custom Sign Algorithm" href=/projects/shenyu/custom-sign-algorithm>Custom Sign Algorithm</a></div></li><li class=item><div class=link><a title="Multilingual Http Client Access" href=/projects/shenyu/developer-shenyu-client>Multilingual Http Client Access</a></div></li><li class=item><div class=link><a title="Thread Model" href=/projects/shenyu/thread>Thread Model</a></div></li><li class=item><div class=link><a title="Shenyu Optimize" href=/projects/shenyu/shenyu-optimize>Shenyu Optimize</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=SPI>SPI</a></div><ul class=leaf-section><li class=item><div class=link><a title="Custom Condition Match" href=/projects/shenyu/custom-condition-match>Custom Condition Match</a></div></li></ul></li></ul></li><li class=item><div class=link><a title="Release Notes" href=/projects/shenyu/release-notes>Release Notes</a></div></li><li class=item><div class=link><a title=Download href=/projects/shenyu/download>Download</a></div></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Data Synchronization Design</h1><a class="edit-button -hidden-mobile" href=https://github.com/apache/incubator-shenyu-website/edit/main/content/en/projects/shenyu/data-sync/index.md>Edit</a></div><div class=meta>Update time: 2021-08-27</div></div><article class=typo><p>This document explains the principle of data synchronization. Data synchronization refers to the strategy used to synchronize data to ShenYu gateway after shenyu-admin background operation data. ShenYu gateway currently supports ZooKeeper, WebSocket, HTTP Long Polling, Nacos, Etcd and Consul for data synchronization.</p><p>See <a href=../use-data-sync>Data Synchronization Configuration</a> for configuration information about data synchronization.</p><p><img src=/img/shenyu/dataSync/data-sync-dir-en.png width=90% height=80%></p><h2 id=preface>Preface</h2><p>Gateway is the entrance of request and it is a very important part in micro service architecture, therefore the importance of gateway high availability is self-evident. When we use gateway, we have to change configuration such as flow rule, route rule for satisfying business requirement. Therefore, the dynamic configuration of the gateway is an important factor to ensure the high availability of the gateway.</p><p>In the actual use of Apache ShenYu Gateway, users also feedback some problems:</p><ul><li><p>Apache ShenYu depends on ZooKeeper, how to use Etcd, Consul, Nacos and other registry center?</p></li><li><p>Apache ShenYu depends on Redis and InfluxDB, and do not use limiting plugins or monitoring plugins. Why need these?</p></li><li><p>Why not use configuration center for configuration synchronization?</p></li><li><p>Why can&rsquo;t updates be configured dynamically?</p></li><li><p>Every time you want to query the database, Redis is a better way.</p></li></ul><p>According to the feedback of users, we have also partially reconstructed ShenYu. The current data synchronization features are as follows:</p><ul><li><p>All configuration is cached in ShenYu gateway memory, each request uses local cache, which is very fast.</p></li><li><p>Users can modify any data in the background of shenyu-admin, and immediately synchronize to the gateway memory.</p></li><li><p>Support ShenYu plugin, selector, rule data, metadata, signature data and other data synchronization.</p></li><li><p>All plugin selectors and rules are configured dynamically and take effect immediately, no service restart required.</p></li><li><p>Data synchronization mode supports Zookeeper, HTTP long polling, Websocket, Nacos, Etcd and Consul.</p></li></ul><h2 id=principle-analysis>Principle Analysis</h2><p>The following figure shows the process of data synchronization of ShenYu. ShenYu Gateway will synchronize configuration data from configuration service at startup, and support push-pull mode to get configuration change information, and then update local cache. The administrator can change the user permissions, rules, plugins and traffic configuration in the admin system(shenyu-admin), and synchronize the change information to ShenYu Gateway through the push-pull mode. Whether the mode is push or pull depends on the synchronization mode used.</p><p><img src=/img/shenyu/dataSync/shenyu-config-processor-en.png width=90% height=80%></p><p>In the original version, the configuration service relied on the Zookeeper implementation to manage the back-end push of changes to the gateway. Now, WebSocket, HTTP long polling, ZooKeeper, Nacos, Etcd, and Consul can now be supported by specifying the corresponding synchronization policy by setting <code>shenyu.sync.${strategy}</code> in the configuration file. The default WeboSocket synchronization policy can be used to achieve second level data synchronization. However, it is important to note that Apache ShenYu Gateway and shenyu-admin must use the same synchronization policy.</p><p>As showing picture below,<code>shenyu-admin</code> will issue a configuration change notification through <code>EventPublisher</code> after users change configuration,<code>EventDispatcher</code> will handle this modification and send configuration to corresponding event handler according to configured synchronization strategy.</p><ul><li>If it is a <code>websocket</code> synchronization strategy,it will push modified data to <code>shenyu-web</code>,and corresponding <code>WebsocketDataHandler</code> handler will handle <code>shenyu-admin</code> data push at the gateway layer</li><li>If it is a <code>zookeeper</code> synchronization strategy,it will push modified data to <code>zookeeper</code>,and the <code>ZookeeperSyncCache</code> will monitor the data changes of <code>zookeeper</code> and process them</li><li>If it is a <code>http</code> synchronization strategy,<code>shenyu-web</code> proactively initiates long polling requests,90 seconds timeout by default,if there is no modified data in <code>shenyu-admin</code>,http request will be blocked,if there is a data change, it will respond to the changed data information,if there is no data change after 60 seconds,then respond with empty data,gateway continue to make http request after getting response,this kind of request will repeat.</li></ul><p><img src=/img/shenyu/dataSync/config-strategy-processor-en.png width=90% height=80%></p><h3 id=zookeeper-synchronization>Zookeeper Synchronization</h3><p>The zookeeper-based synchronization principle is very simple,it mainly depends on <code>zookeeper</code> watch mechanism,<code>shenyu-web</code> will monitor the configured node,when <code>shenyu-admin</code> starts,all the data will be written to <code>zookeeper</code>,it will incrementally update the nodes of <code>zookeeper</code> when data changes,at the same time, <code>shenyu-web</code> will monitor the node for configuration information, and update the local cache once the information changes</p><p><img src=https://yu199195.github.io/images/soul/soul-zookeeper.png alt="Zookeeper Node Design"></p><p><code>Apache ShenYu</code> writes the configuration information to the zookeeper node,and it is meticulously designed. If you want to learn more about the code implementation, refer to the source code <code>ZookeeperSyncDataService</code>.</p><h3 id=websocket-synchronization>WebSocket Synchronization</h3><p>The mechanism of <code>websocket</code> and <code>zookeeper</code> is similar,when the gateway and the <code>shenyu-admin</code> establish a <code>websocket</code> connection,<code>shenyu-admin</code> will push all data at once,it will automatically push incremental data to <code>shenyu-web</code> through <code>websocket</code> when configured data changes</p><p>When we use websocket synchronization,pay attention to reconnect after disconnection,which also called keep heartbeat.<code>Apache ShenYu</code> uses <code>java-websocket</code> ,a third-party library,to connect to <code>websocket</code>. If you want to learn more about the code implementation, refer to the source code <code>WebsocketSyncDataService</code>.</p><h3 id=http-long-polling>Http Long Polling</h3><p>The mechanism of zookeeper and websocket data synchronization is relatively simple,but http synchronization will be relatively complicated.ShenYu borrows the design ideas of <code>Apollo</code> and <code>Nacos</code> and realizes <code>http</code> long polling data synchronization using their advantages.Note that this is not traditional ajax long polling.</p><p><img src=/img/shenyu/dataSync/http-long-polling-en.png width=90% height=80%></p><p>http long polling mechanism as above,shenyu-web gateway requests shenyu-admin configuration services,timeout is 90 seconds,it means gateway layer request configuration service will wait at most 90 seconds,this is convenient for shenyu-admin configuration service to respond modified data in time,and therefore we realize near real-time push.</p><p>After the http request reaches shenyu-admin, it does not respond immediately,but uses the asynchronous mechanism of Servlet3.0 to asynchronously respond to the data.First of all,put long polling request task <code>LongPollingClient</code> into <code>BlocingQueue</code>,and then start scheduling task,execute after 60 seconds,this aims to remove the long polling request from the queue after 60 seconds,even there is no configured data change.Because even if there is no configuration change,gateway also need to know,otherwise it will wait,and there is a 90 seconds timeout when the gateway requests configuration services.</p><p>If the administrator changes the configuration data during this period,the long polling requests in the queue will be removed one by one, and respond which group’s data has changed(we distribute plugins, rules, flow configuration , user configuration data into different groups).After gateway receives response,it only knows which Group has changed its configuration,it need to request again to get group configuration data.Someone may ask,why don&rsquo;t you write out the changed data directly?We also discussed this issue deeply during development, because the http long polling mechanism can only guarantee quasi real-time,if gateway layer does not handle it in time,or administrator updates configuration frequently,we probably missed some configuration change push.For security, we only inform that a certain Group information has changed.</p><p>When <code>shenyu-web</code> gateway layer receives the http response information,pull modified information(if exists),and then request <code>shenyu-admin</code> configuration service again,this will repeatedly execute. If you want to learn more about the code implementation, refer to the source code <code>HttpSyncDataService</code>.</p><h3 id=nacos-synchronization>Nacos Synchronization</h3><p>The synchronization principle of Nacos is basically similar to that of ZooKeeper, and it mainly depends on the configuration management of Nacos. The path of each configuration node is similar to that of ZooKeeper.</p><p>ShenYu gateway will monitor the configured node. At startup, if there is no configuration node in Nacos, it will write the synchronous full amount of data into Nacos. When the sequential data send changes, it will update the configuration node in Nacos in full amount. The local cache is updated.</p><p>If you want to learn more about the code implementation, please refer to the source code <code>NacosSyncDataService</code> and the official documentation for <a href=https://nacos.io/zh-cn/docs/sdk.html>Nacos</a> .</p><h3 id=etcd-synchronization>Etcd Synchronization</h3><p>Etcd data synchronization principle is similar to Zookeeper, mainly relying on Etcd&rsquo;s watch mechanism, and each configuration node path is the same as that of Zookeeper.</p><p>The native API for Etcd is a bit more complicated to use, so it&rsquo;s somewhat encapsulated.</p><p>ShenYu gateway will listen to the configured node. When startup, if there is no configuration node in Etcd, it will write the synchronous full amount of data into Etcd. When the sequential data send changes, it will update the configuration node in Etcd incrementally.</p><p>If you want to learn more about the code implementation, refer to the source <code>EtcdSyncDataService</code>.</p><h3 id=consul-synchronization>Consul Synchronization</h3><p>Consul data synchronization principle is that the gateway regularly polls Consul&rsquo;s configuration center to get the configuration version number for local comparison.</p><p>ShenYu gateway will poll the configured nodes regularly, and the default interval is 1s. When startup, if there is no configuration node in Consul, write the synchronous full amount of data into Consul, then incrementally update the configuration node in Consul when the subsequent data is sent to change. At the same time, Apache ShenYu Gateway will regularly polls the node of configuration information and pull the configuration version number for comparison with the local one. The local cache is updated when the version number is changed.</p><p>If you want to learn more about the code implementation, refer to the source <code>ConsulsyncDataService</code>.</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class="cate  -show-mobile"><h2 class=cate-title>Apache</h2><a class=link href=https://www.apache.org/>Foundation</a>
<a class=link href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=link href=https://www.apache.org/licenses/>License</a>
<a class=link href=https://www.apache.org/security/>Security</a>
<a class=link href=http://www.apache.org/events/current-event>Events</a>
<a class=link href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
<a class=link href=http://www.apache.org/foundation/thanks.html>Thanks</a></div><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/apache/incubator-shenyu>Github</a>
<a class=link href=/projects/shenyu/overview/>Documentation</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/apache/incubator-shenyu/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/news>News</a>
<a class=link href=/awesome>Awesome</a></div><div class=cate><h2 class=cate-title>Subscribe mailing list</h2><a class=link href=/community/subscribe-email/>How to subscribe</a>
<a class=link href=mailto://dev-subscribe@shenyu.apache.org>Subscribe Mail</a>
<a class=link href=https://lists.apache.org/list.html?dev@shenyu.apache.org>Mail Archive</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/WechatIMG127.jpeg><p class=qrcode-desc>Wechat Official Account</p></div></div></div><div class=copyright><p>Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.
Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache ShenYu logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.
Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator.
Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects.
While incubation status is not necessarily a reflection of the completeness or stability of the code,
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></footer></body></html>
<!doctype html><html><head><title>应用客户端接入 · ShenYu</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="zh"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link style=font-size:25px;margin-right:50px href=/zh/><img class=logo src=/img/logo/apache-shenyu.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=请输入要搜索的关键词><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/zh/projects/shenyu/download/><span>下载</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/shenyu/overview/><span>文档</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/community/code-conduct/><span>社区</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/news/><span>新闻</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/awesome/><span>Awesome</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/shenyu/register-center-design/><span>English</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/zh/projects/shenyu/download/>下载</a>
<a class=navbar-item href=/zh/projects/shenyu/overview/>文档</a>
<a class=navbar-item href=/zh/community/code-conduct/>社区</a>
<a class=navbar-item href=/zh/news/>新闻</a>
<a class=navbar-item href=/zh/awesome/>Awesome</a>
<span class="navbar-item nav-hover"><a>Links</a><div class=dropdown-menu><a class=dropdown-item href=https://www.apache.org/>Apache Software Foundation</a>
<a class=dropdown-item href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=dropdown-item href=https://www.apache.org/>License</a>
<a class=dropdown-item href=http://www.apache.org/events/current-event>Apache Events</a>
<a class=dropdown-item href=https://www.apache.org/licenses/>Security</a>
<a class=dropdown-item href=http://www.apache.org/foundation/sponsorship.html>Sponsor and Donate</a>
<a class=dropdown-item href=http://www.apache.org/foundation/thanks.html>Thanks</a></div></span></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=请输入要搜索的关键词><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/shenyu/register-center-design/>En</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="Apache ShenYu是一个异步的，高性能的，跨语言的，响应式的API网关。">Apache ShenYu(current)<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>主要项目</h4><ul class=list><li class=item><a href=/zh/projects/shenyu/overview>Apache ShenYu(current)</a></li><li class=item><a href=/zh/projects/shenyu-2.3.0/overview>Apache ShenYu(2.3.0)</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title=介绍 href=/zh/projects/shenyu/overview>介绍</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=设计文档>设计文档</a></div><ul class=leaf-section><li class=item><div class=link><a title="ShenYu Admin数据结构" href=/zh/projects/shenyu/database-design>ShenYu Admin数据结构</a></div></li><li class=item><div class=link><a title=数据同步 href=/zh/projects/shenyu/data-sync>数据同步</a></div></li><li class=item><div class="link -current"><a title=应用客户端接入 href=/zh/projects/shenyu/register-center-design>应用客户端接入</a></div></li><li class=item><div class=link><a title=流量控制 href=/zh/projects/shenyu/flow-control>流量控制</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=快速开始>快速开始</a></div><ul class=leaf-section><li class=item><div class=link><a title=环境搭建 href=/zh/projects/shenyu/shenyu-set-up>环境搭建</a></div></li><li class=item><div class=link><a title=Dubbo代理 href=/zh/projects/shenyu/quick-start-dubbo>Dubbo代理</a></div></li><li class=item><div class=link><a title=Http代理 href=/zh/projects/shenyu/quick-start-http>Http代理</a></div></li><li class=item><div class=link><a title=gRPC代理 href=/zh/projects/shenyu/quick-start-grpc>gRPC代理</a></div></li><li class=item><div class=link><a title="Spring Cloud代理" href=/zh/projects/shenyu/quick-start-springcloud>Spring Cloud代理</a></div></li><li class=item><div class=link><a title=Sofa代理 href=/zh/projects/shenyu/quick-start-sofa>Sofa代理</a></div></li><li class=item><div class=link><a title=Tars代理 href=/zh/projects/shenyu/quick-start-tars>Tars代理</a></div></li><li class=item><div class=link><a title=Motan代理 href=/zh/projects/shenyu/quick-start-motan>Motan代理</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=用户文档>用户文档</a></div><ul class=leaf-section><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=admin使用>admin使用</a></div><ul class=leaf-section><li class=item><div class=link><a title=插件配置 href=/zh/projects/shenyu/plugin-handle-explanation>插件配置</a></div></li><li class=item><div class=link><a title=选择器和规则配置 href=/zh/projects/shenyu/selector-and-rule>选择器和规则配置</a></div></li><li class=item><div class=link><a title=字典配置 href=/zh/projects/shenyu/dictionary-management>字典配置</a></div></li><li class=item><div class=link><a title=权限管理 href=/zh/projects/shenyu/authority-management>权限管理</a></div></li></ul></li><li class=item><div class=link><a title=Http代理 href=/zh/projects/shenyu/http-proxy>Http代理</a></div></li><li class=item><div class=link><a title=Dubbo代理 href=/zh/projects/shenyu/dubbo-proxy>Dubbo代理</a></div></li><li class=item><div class=link><a title=SpringCloud代理 href=/zh/projects/shenyu/spring-cloud-proxy>SpringCloud代理</a></div></li><li class=item><div class=link><a title=Sofa代理 href=/zh/projects/shenyu/sofa-rpc-proxy>Sofa代理</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=插件集合>插件集合</a></div><ul class=leaf-section><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Http 处理">Http 处理</a></div><ul class=leaf-section><li class=item><div class=link><a title=Divide插件 href=/zh/projects/shenyu/divide-plugin>Divide插件</a></div></li><li class=item><div class=link><a title=Rewrite插件 href=/zh/projects/shenyu/rewrite-plugin>Rewrite插件</a></div></li><li class=item><div class=link><a title=Redirect插件 href=/zh/projects/shenyu/redirect-plugin>Redirect插件</a></div></li><li class=item><div class=link><a title=Request插件 href=/zh/projects/shenyu/request-plugin>Request插件</a></div></li><li class=item><div class=link><a title=Context-path插件 href=/zh/projects/shenyu/context-path-plugin>Context-path插件</a></div></li><li class=item><div class=link><a title=Param-mapping插件 href=/zh/projects/shenyu/param-mapping-plugin>Param-mapping插件</a></div></li><li class=item><div class=link><a title=ModifyResponse插件 href=/zh/projects/shenyu/modify-response-plugin>ModifyResponse插件</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="RPC 代理">RPC 代理</a></div><ul class=leaf-section><li class=item><div class=link><a title=Dubbo插件 href=/zh/projects/shenyu/dubbo-plugin>Dubbo插件</a></div></li><li class=item><div class=link><a title="Spring Cloud插件" href=/zh/projects/shenyu/spring-cloud-plugin>Spring Cloud插件</a></div></li><li class=item><div class=link><a title=Sofa插件 href=/zh/projects/shenyu/sofa-plugin>Sofa插件</a></div></li><li class=item><div class=link><a title=gRPC插件 href=/zh/projects/shenyu/grpc-plugin>gRPC插件</a></div></li><li class=item><div class=link><a title=Tars插件 href=/zh/projects/shenyu/tars-plugin>Tars插件</a></div></li><li class=item><div class=link><a title=Motan插件 href=/zh/projects/shenyu/motan-plugin>Motan插件</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=熔断和限流>熔断和限流</a></div><ul class=leaf-section><li class=item><div class=link><a title=Hystrix插件 href=/zh/projects/shenyu/hystrix-plugin>Hystrix插件</a></div></li><li class=item><div class=link><a title=Sentinel插件 href=/zh/projects/shenyu/sentinel-plugin>Sentinel插件</a></div></li><li class=item><div class=link><a title=Resilience4j插件 href=/zh/projects/shenyu/resilience4j-plugin>Resilience4j插件</a></div></li><li class=item><div class=link><a title=RateLimiter插件 href=/zh/projects/shenyu/rate-limiter-plugin>RateLimiter插件</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=权限认证>权限认证</a></div><ul class=leaf-section><li class=item><div class=link><a title=Waf插件 href=/zh/projects/shenyu/waf-plugin>Waf插件</a></div></li><li class=item><div class=link><a title=Sign插件 href=/zh/projects/shenyu/sign-plugin>Sign插件</a></div></li><li class=item><div class=link><a title=JWT插件 href=/zh/projects/shenyu/jwt-plugin>JWT插件</a></div></li><li class=item><div class=link><a title="OAuth 2插件" href=/zh/projects/shenyu/oauth2-plugin>OAuth 2插件</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=可观测性>可观测性</a></div><ul class=leaf-section><li class=item><div class=link><a title=Monitor插件 href=/zh/projects/shenyu/monitor-plugin>Monitor插件</a></div></li><li class=item><div class=link><a title=Logging插件 href=/zh/projects/shenyu/logging-plugin>Logging插件</a></div></li></ul></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=开发者文档>开发者文档</a></div><ul class=leaf-section><li class=item><div class=link><a title=自定义filter href=/zh/projects/shenyu/custom-filter>自定义filter</a></div></li><li class=item><div class=link><a title=自定义插件 href=/zh/projects/shenyu/custom-plugin>自定义插件</a></div></li><li class=item><div class=link><a title=文件上传下载 href=/zh/projects/shenyu/file-and-image>文件上传下载</a></div></li><li class=item><div class=link><a title=自定义解析IP与Host href=/zh/projects/shenyu/custom-parsing-ip-and-host>自定义解析IP与Host</a></div></li><li class=item><div class=link><a title=自定义返回结果 href=/zh/projects/shenyu/custom-result>自定义返回结果</a></div></li><li class=item><div class=link><a title=自定义签名插件算法与验证 href=/zh/projects/shenyu/custom-sign-algorithm>自定义签名插件算法与验证</a></div></li><li class=item><div class=link><a title=多语言http客户端接入 href=/zh/projects/shenyu/developer-shenyu-client>多语言http客户端接入</a></div></li><li class=item><div class=link><a title=线程模型 href=/zh/projects/shenyu/thread>线程模型</a></div></li><li class=item><div class=link><a title=shenyu调优 href=/zh/projects/shenyu/shenyu-optimize>shenyu调优</a></div></li><li class=item><div class=link><a title=SPI href=/zh/projects/shenyu/spi-design>SPI</a></div></li></ul></li><li class=item><div class=link><a title=版本发布 href=/zh/projects/shenyu/change-log>版本发布</a></div></li><li class=item><div class=link><a title=文档下载 href=/zh/projects/shenyu/download>文档下载</a></div></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>应用客户端接入</h1><a class="edit-button -hidden-mobile" href=https://github.com/apache/incubator-shenyu-website/edit/main/content/zh/projects/shenyu/register-center-design/index.md>编辑</a></div><div class=meta>更新时间: 2021-07-14</div></div><article class=typo><p>应用客户端接入是指将你的微服务接入到<code>ShenYu</code>网关，当前支持<code>Http</code>、 <code>Dubbo</code>、 <code>Spring Cloud</code>、 <code>gRPC</code>、 <code>Motan</code>、 <code>Sofa</code>、 <code>Tars</code>等协议的接入。</p><p><img src=/img/shenyu/register/register-content.png width=70% height=60%></p><h2 id=设计原理>设计原理</h2><p>将应用客户端接入到<code>ShenYu</code>网关是通过注册中心来实现的，涉及到客户端注册和服务端同步数据。注册中心支持<code>Http</code>、<code>Zookeeper</code>、<code>Etcd</code>、<code>Consul</code>和<code>Nacos</code>。</p><h3 id=注册中心客户端>注册中心客户端</h3><p><img src=/img/shenyu/register/client.png alt></p><p>在你的微服务配置中声明注册中心客户端类型，如<code>Http</code>或<code>Zookeeper</code>。
应用程序启动时使用<code>SPI</code>方式加载并初始化对应注册中心客户端，通过实现<code>Spring Bean</code>相关的后置处理器接口，在其中获取需要进行注册的服务接口信息，将获取的信息放入<code>Disruptor</code>中。</p><p>注册中心客户端从<code>Disruptor</code>中读取数据，并将接口信息注册到<code>shenyu-admin</code>，<code>Disruptor</code>在其中起数据与操作解耦的作用，利于扩展。</p><h3 id=注册中心服务端>注册中心服务端</h3><p><img src=/img/shenyu/register/server.png alt></p><p>在<code>shenyu-admin</code>配置中声明注册中心服务端类型，如<code>Http</code>或<code>Zookeeper</code>。当<code>shenyu-admin</code>启动时，读取配置类型，加载并初始化对应的注册中心服务端，注册中心服务端收到<code>shenyu-client</code>注册的接口信息后，将其放入<code>Disruptor</code>中，然后会触发注册处理逻辑，将服务接口信息更新并发布同步事件。</p><p><code>Disruptor</code>在其中起到数据与操作解耦，利于扩展。如果注册请求过多，导致注册异常，也有数据缓冲作用。</p><h3 id=http注册原理>Http注册原理</h3><p><code>Http</code>服务注册原理较为简单，在<code>shenyu-client</code>启动后，会调用<code>shenyu-admin</code>的相关服务注册接口，上传数据进行注册。</p><p><code>shenyu-admin</code> 收到请求后进行数据更新和数据同步事件发布，将接口信息同步到<code>ShenYu</code>网关。</p><h3 id=zookeeper注册原理>Zookeeper注册原理</h3><p><code>Zookeeper</code>存储结构如下：</p><pre><code>shenyu
   ├──regsiter
   ├    ├──metadata
   ├    ├     ├──${rpcType}
   ├    ├     ├      ├────${contextPath}
   ├    ├     ├               ├──${ruleName} : save metadata data of MetaDataRegisterDTO
   ├    ├──uri
   ├    ├     ├──${rpcType}
   ├    ├     ├      ├────${contextPath}
   ├    ├     ├               ├──${ip:prot} : save uri data of URIRegisterDTO
   ├    ├     ├               ├──${ip:prot}
</code></pre><p><code>shenyu-client</code>启动时，将服务接口信息（<code>MetaDataRegisterDTO/URIRegisterDTO</code>）写到如上的<code>zookeeper</code>节点中。</p><p><code>shenyu-admin</code>使用<code>Zookeeper</code>的<code>Watch</code>机制，对数据的更新和删除等事件进行监听，数据变更后触发对应的注册处理逻辑。在收到<code>MetaDataRegisterDTO</code>节点变更后，触发<code>selector</code>和<code>rule</code>的数据变更和数据同步事件发布。收到<code>URIRegisterDTO</code>节点变更后，触发<code>selector</code>的<code>upstream</code>的更新和数据同步事件发布。</p><h2 id=etcd注册原理>Etcd注册原理</h2><p><code>Etcd</code>的键值存储结构如下：</p><pre><code>shenyu
   ├──regsiter
   ├    ├──metadata
   ├    ├     ├──${rpcType}
   ├    ├     ├      ├────${contextPath}
   ├    ├     ├               ├──${ruleName} : save metadata data of MetaDataRegisterDTO
   ├    ├──uri
   ├    ├     ├──${rpcType}
   ├    ├     ├      ├────${contextPath}
   ├    ├     ├               ├──${ip:prot} : save uri data of URIRegisterDTO
   ├    ├     ├               ├──${ip:prot}
</code></pre><p><code>shenyu-client</code>启动时，将服务接口信息（<code>MetaDataRegisterDTO/URIRegisterDTO</code>）以<code>Ephemeral</code>方式写到如上的<code>Etcd</code>节点中。</p><p><code>shenyu-admin</code>使用<code>Etcd</code>的<code>Watch</code>机制，对数据的更新和删除等事件进行监听，数据变更后触发对应的注册处理逻辑。在收到<code>MetaDataRegisterDTO</code>节点变更后，触发<code>selector</code>和<code>rule</code>的数据变更和数据同步事件发布。收到<code>URIRegisterDTO</code>节点变更后，触发<code>selector</code>的<code>upstream</code>的更新和数据同步事件发布。</p><h2 id=consul注册原理>Consul注册原理</h2><p><code>Consul</code>的<code>Metadata</code>和<code>URI</code>分两部分存储，<code>URIRegisterDTO</code>随着服务注册记录在服务的<code>metadata</code>里，服务下线时随着服务节点一起消失。</p><p><code>Consul</code>的<code>MetaDataRegisterDTO</code>存在<code>Key/Value</code>里，键值存储结构如下：</p><pre><code>shenyu
   ├──regsiter
   ├    ├──metadata
   ├    ├     ├──${rpcType}
   ├    ├     ├      ├────${contextPath}
   ├    ├     ├               ├──${ruleName} : save metadata data of MetaDataRegisterDTO

</code></pre><p><code>shenyu-client</code>启动时，将服务接口信息（<code>MetaDataRegisterDTO/URIRegisterDTO</code>）分别放在<code>ServiceInstance</code>的<code>Metadata</code>（<code>URIRegisterDTO</code>）和<code>KeyValue</code>（<code>MetaDataRegisterDTO</code>），按照上述方式进行存储。</p><p><code>shenyu-admin</code>通过监听<code>Catalog</code>和<code>KeyValue</code>的<code>index</code>的变化，来感知数据的更新和删除，数据变更后触发对应的注册处理逻辑。在收到<code>MetaDataRegisterDTO</code>节点变更后，触发<code>selector</code>和<code>rule</code>的数据变更和数据同步事件发布。收到<code>URIRegisterDTO</code>节点变更后，触发<code>selector</code>的<code>upstream</code>的更新和数据同步事件发布。</p><h2 id=nacos注册原理>Nacos注册原理</h2><p><code>Nacos</code>注册分为两部分：<code>URI</code> 和 <code>Metadata</code>。<code>URI</code> 使用实例注册方式，在服务异常的情况下，相关<code>URI</code>数据节点会自动进行删除，并发送事件到订阅端，订阅端进行相关的下线处理。<code>Metadata</code> 使用配置注册方式，没有相关上下线操作，当有<code>URI</code>实例注册时，会相应的发布<code>Metadata</code>配置，订阅端监听数据变化，进行更新处理。</p><p><code>URI</code>实例注册命令规则如下：</p><pre><code>shenyu.register.service.${rpcType}
</code></pre><p>初始监听所有的<code>RpcType</code>节点，其下的<code>{contextPath}</code>实例会对应注册到其下，根据<code>IP</code>和<code>Port</code>进行区分，并携带其对应的<code>contextPath</code>信息。<code>URI</code> 实例上下线之后，触发<code>selector</code>的<code>upstream</code>的更新和数据同步事件发布。</p><p><code>URI</code> 实例上线时，会发布对应的 <code>Metadata</code> 数据，其节点名称命令规则如下：</p><pre><code>shenyu.register.service.${rpcType}.${contextPath}
</code></pre><p>订阅端会对所有的<code>Metadata</code>配置继续监听，当初次订阅和配置更新后，触发<code>selector</code>和<code>rule</code>的数据变更和数据同步事件发布。</p><h3 id=spi扩展>SPI扩展</h3><table><thead><tr><th><em>SPI 名称</em></th><th><em>详细说明</em></th></tr></thead><tbody><tr><td>ShenyuClientRegisterRepository</td><td>ShenYu网关客户端接入注册服务资源</td></tr></tbody></table><table><thead><tr><th><em>已知实现类</em></th><th><em>详细说明</em></th></tr></thead><tbody><tr><td>HttpClientRegisterRepository</td><td>基于Http请求的实现</td></tr><tr><td>ZookeeperClientRegisterRepository</td><td>基于Zookeeper注册的实现</td></tr><tr><td>EtcdClientRegisterRepository</td><td>基于Etcd注册的实现</td></tr><tr><td>ConsulClientRegisterRepository</td><td>基于Consul注册的实现</td></tr><tr><td>NacosClientRegisterRepository</td><td>基于Nacos注册的实现</td></tr></tbody></table><table><thead><tr><th><em>SPI 名称</em></th><th><em>详细说明</em></th></tr></thead><tbody><tr><td>ShenyuServerRegisterRepository</td><td>ShenYu网关客户端注册的后台服务资源</td></tr></tbody></table><table><thead><tr><th><em>已知实现类</em></th><th><em>详细说明</em></th></tr></thead><tbody><tr><td>ShenyuHttpRegistryController</td><td>使用Http服务接口来处理客户端注册请求</td></tr><tr><td>ZookeeperServerRegisterRepository</td><td>使用Zookeeper来处理客户端注册节点</td></tr><tr><td>EtcdServerRegisterRepository</td><td>使用Etcd来处理客户端注册节点</td></tr><tr><td>ConsulServerRegisterRepository</td><td>使用Consul来处理客户端注册节点</td></tr><tr><td>NacosServerRegisterRepository</td><td>使用Nacos来处理客户端注册节点</td></tr></tbody></table><h2 id=接入配置>接入配置</h2><p>介绍将应用客户端接入到<code>ShenYu</code>网关，应该如何配置。</p><h3 id=http方式注册配置>Http方式注册配置</h3><h4 id=shenyu-admin配置>shenyu-admin配置</h4><p>在 <code>yml</code>文件中配置注册类型为<code>http</code>，配置信息如下：</p><pre><code class=language-yaml>shenyu:
  register:
    registerType: http
    props:
      checked: true  #是否开启检测
      zombieCheckTimes: 5 #失败几次后剔除服务
      scheduledTime: 10 #定时检测间隔时间 （秒）
</code></pre><p><img src=/img/shenyu/register/register-http-admin-yml.png width=70% height=60%></p><h4 id=shenyu-client配置>shenyu-client配置</h4><p>下面展示的是<code>http</code>服务作为客户端接入到<code>ShenYu</code>网关时，通过<code>Http</code>方式注册配置信息。其他客户端接入时（<code>Dubbo</code>、 <code>Spring Cloud</code>等），配置方式同理。</p><p>在微服务中的 <code>yml</code>文件配置注册方式设置为<code>http</code>，并填写<code>shenyu-admin</code>服务地址列表，配置信息如下：</p><pre><code class=language-yaml>shenyu:
  client:
    registerType: http
    serverLists: http://localhost:9095
    props:
      contextPath: /http
      appName: http
      port: 8188  
      isFull: false
# registerType : 服务注册类型，填写 http
# serverList: 为http注册类型时，填写Shenyu-Admin项目的地址，注意加上http://，多个地址用英文逗号分隔
# port: 你本项目的启动端口，目前springmvc/tars/grpc需要进行填写
# contextPath: 为你的这个mvc项目在shenyu网关的路由前缀， 比如/order ，/product 等等，网关会根据你的这个前缀来进行路由.
# appName：你的应用名称，不配置的话，会默认取 `spring.application.name` 的值
# isFull: 设置true 代表代理你的整个服务，false表示代理你其中某几个controller；目前适用于springmvc/springcloud
</code></pre><p><img src=/img/shenyu/register/register-http-client-yml.png width=70% height=60%></p><h3 id=zookeeper方式注册配置>Zookeeper方式注册配置</h3><h4 id=shenyu-admin配置-1>shenyu-admin配置</h4><ul><li>首先在 <code>pom</code> 文件中加入相关的依赖（默认已经引入）：</li></ul><pre><code class=language-xml>        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-server-zookeeper&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-zk-admin-pom.png width=70% height=60%></p><ul><li>然后在<code>yml</code>文件中配置注册类型为<code>zookeeper</code>，填写<code>zookeeper</code>服务地址和参数，配置信息如下：</li></ul><pre><code class=language-yaml>shenyu:
  register:
    registerType: zookeeper
    serverLists: localhost:2181
    props:
      sessionTimeout: 5000
      connectionTimeout: 2000
</code></pre><p><img src=/img/shenyu/register/register-zk-admin-yml.png width=70% height=60%></p><h4 id=shenyu-client配置-1>shenyu-client配置</h4><p>下面展示的是<code>http</code>服务作为客户端接入到<code>ShenYu</code>网关时，通过<code>Zookeeper</code>方式注册配置信息。其他客户端接入时（<code>Dubbo</code>、 <code>Spring Cloud</code>等），配置方式同理。</p><ul><li>首先在 <code>pom</code>文件中加入相关的依赖：</li></ul><pre><code class=language-xml>        &lt;!--shenyu zookeeper register center --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-server-zookeeper&lt;/artifactId&gt;
            &lt;version&gt;${shenyu.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-zk-client-pom.png width=70% height=60%></p><ul><li>然后在 <code>yml</code> 中配置注册类型为<code>zookeeper</code>，并填写<code>Zookeeper</code>服务地址和相关参数，如下：</li></ul><pre><code class=language-yaml>shenyu:
  client:
    registerType: zookeeper
    serverLists: localhost:2181
    props:
      contextPath: /http
      appName: http
      port: 8189  
      isFull: false
# registerType : 服务注册类型，填写 zookeeper
# serverList: 为zookeeper注册类型时，填写zookeeper地址，多个地址用英文分隔
# port: 你本项目的启动端口,目前springmvc/tars/grpc需要进行填写
# contextPath: 为你的这个mvc项目在shenyu网关的路由前缀， 比如/order ，/product 等等，网关会根据你的这个前缀来进行路由.
# appName：你的应用名称，不配置的话，会默认取 `spring.application.name` 的值
# isFull: 设置true 代表代理你的整个服务，false表示代理你其中某几个controller；目前适用于springmvc/springcloud
</code></pre><p><img src=/img/shenyu/register/register-zk-client-yml.png width=70% height=60%></p><h3 id=etcd方式注册配置>Etcd方式注册配置</h3><h4 id=shenyu-admin配置-2>shenyu-admin配置</h4><ul><li>首先在 <code>pom</code> 文件中加入相关的依赖（默认已经引入）：</li></ul><pre><code class=language-xml>        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-server-etcd&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-etcd-admin-pom.png width=70% height=60%></p><ul><li>然后在 <code>yml</code> 配置注册类型为<code>etcd</code>, 填写<code>etcd</code>服务地址和参数，配置信息如下：</li></ul><pre><code class=language-yaml>shenyu:
  register:
    registerType: etcd
    serverLists : http://localhost:2379
    props:
      etcdTimeout: 5000
      etcdTTL: 5
</code></pre><p><img src=/img/shenyu/register/register-etcd-admin-yml.png width=70% height=60%></p><h4 id=shenyu-client配置-2>shenyu-client配置</h4><p>下面展示的是<code>http</code>服务作为客户端接入到<code>ShenYu</code>网关时，通过<code>Etcd</code>方式注册配置信息。其他客户端接入时（<code>Dubbo</code>、 <code>Spring Cloud</code>等），配置方式同理。</p><ul><li>首先在 <code>pom</code> 文件中加入相关的依赖：</li></ul><pre><code class=language-xml>        &lt;!--shenyu etcd register center --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-server-etcd&lt;/artifactId&gt;
            &lt;version&gt;${shenyu.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-etcd-client-pom.png width=70% height=60%></p><ul><li>然后在 <code>yml</code> 中配置注册类型为<code>etcd</code>, 并填写<code>etcd</code>服务地址和相关参数，如下：</li></ul><pre><code class=language-yaml>shenyu:
  client:
    registerType: etcd 
    serverLists: http://localhost:2379
    props:
      contextPath: /http
      appName: http
      port: 8189  
      isFull: false
# registerType : 服务注册类型，填写 etcd
# serverList: 为etcd注册类型时，填写etcd地址，多个地址用英文分隔
# port: 你本项目的启动端口,目前springmvc/tars/grpc需要进行填写
# contextPath: 为你的这个mvc项目在shenyu网关的路由前缀， 比如/order ，/product 等等，网关会根据你的这个前缀来进行路由.
# appName：你的应用名称，不配置的话，会默认取 `spring.application.name` 的值
# isFull: 设置true 代表代理你的整个服务，false表示代理你其中某几个controller；目前适用于springmvc/springcloud
</code></pre><p><img src=/img/shenyu/register/register-etcd-client-yml.png width=70% height=60%></p><h3 id=consul方式注册配置>Consul方式注册配置</h3><h4 id=shenyu-admin配置-3>shenyu-admin配置</h4><ul><li>首先在 pom.xml 文件中加入相关的依赖：</li></ul><pre><code class=language-xml>        &lt;!--shenyu consul register start--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-server-consul&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--spring-cloud-starter-consul-discovery需要用户自行引入，建议选用2.2.6.RELEASE版本，其他版本不保证正常工作--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
            &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--shenyu consul register end--&gt;

</code></pre><p><img src=/img/shenyu/register/register-consul-admin-pom.png width=70% height=60%></p><ul><li>在 <code>yml</code>文件配置注册中心为<code>consul</code>, 额外还需要配置<code>spring.cloud.consul</code>, 配置信息如下：</li></ul><pre><code class=language-yaml>shenyu:
  register:
    registerType: consul
    props:
      delay: 1
      wait-time: 55

spring:
  cloud:
    consul:
      discovery:
        instance-id: shenyu-admin-1
        service-name: shenyu-admin
        tags-as-metadata: false
      host: localhost
      port: 8500

# registerType : 服务注册类型，填写 consul
# delay: 对Metadata的监控每次轮询的间隔时长，单位为秒，默认1秒
# wait-time: 对Metadata的监控单次请求的等待时间（长轮询机制），单位为秒，默认55秒
# instance-id: consul服务必填，consul需要通过instance-id找到具体服务
# service-name 服务注册到consul时所在的组名，不配置的话，会默认取 `spring.application.name` 的值
# host: 为 consul 注册类型时，填写 consul 地址，默认localhost
# port: 为 consul 注册类型时，填写 consul 端口， 默认是8500
# tags-as-metadata: false， 必填，如果不填默认为true，则无法读取metadata里的URI信息导致selector的upstream数据更新失败。

</code></pre><p><img src=/img/shenyu/register/register-consul-admin-yml.png width=70% height=60%></p><h4 id=shenyu-client配置-3>shenyu-client配置</h4><p><strong>注意，<code>consul</code>注册中心目前和<code>SpringCloud</code>服务不兼容，会和<code>Eureka/Nacos</code>注册中心冲突</strong></p><p>下面展示的是<code>http</code>服务作为客户端接入到<code>ShenYu</code>网关时，通过<code>Consul</code>方式注册配置信息。其他客户端接入时（<code>Dubbo</code>、 <code>Spring Cloud</code>等），配置方式同理。</p><ul><li>首先在 <code>pom</code> 文件中加入相关的依赖：</li></ul><pre><code class=language-xml>            &lt;dependency&gt;
               &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
               &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
               &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
           &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-consul-client-pom.png width=70% height=60%></p><ul><li>然后在 <code>yml</code>文件中配置注册方式为<code>consul</code>, 额外还需要配置<code>spring.cloud.consul</code>, 配置信息如下：</li></ul><pre><code class=language-yaml>shenyu:
  client:
    registerType: consul 
    props:
      contextPath: /http
      appName: http
      port: 8188  
      isFull: false

spring:
  cloud:
    consul:
      discovery:
        instance-id: shenyu-http-1
        service-name: shenyu-http
      host: localhost
      port: 8500
# registerType : 服务注册类型，填写 consul
# shenyu.client.props.port: 你本项目的启动端口,目前springmvc/tars/grpc需要进行填写
# contextPath: 为你的这个mvc项目在shenyu网关的路由前缀， 比如/order ，/product 等等，网关会根据你的这个前缀来进行路由.
# appName：你的应用名称，不配置的话，会默认取 `spring.application.name` 的值
# isFull: 设置true 代表代理你的整个服务，false表示代理你其中某几个controller；目前适用于springmvc
# instance-id: consul服务必填，consul需要通过instance-id找到具体服务
# service-name 服务注册到consul时所在的组名，不配置的话，会默认取 `spring.application.name` 的值
# host: 为 consul 注册类型时，填写 consul 地址，默认localhost
# spring.cloud.consul.port: 为 consul 注册类型时，填写 consul 端口， 默认是8500
</code></pre><p><img src=/img/shenyu/register/register-consul-client-yml.png width=70% height=60%></p><h3 id=nacos方式注册配置>Nacos方式注册配置</h3><h4 id=shenyu-admin配置-4>shenyu-admin配置</h4><ul><li>首先在 <code>pom</code> 文件中加入相关的依赖（默认已经引入）：</li></ul><pre><code class=language-xml>        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-server-nacos&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-nacos-admin-pom.png width=70% height=60%></p><ul><li>然后在 <code>yml</code>文件中配置注册中心为<code>nacos</code>, 填写相关<code>nacos</code>服务地址和参数，还有<code>nacos</code>的命名空间（需要和<code>shenyu-client</code>保持一致），配置信息如下：</li></ul><pre><code class=language-yaml>shenyu:
  register:
    registerType: nacos
    serverLists : localhost:8848
    props:
      nacosNameSpace: ShenyuRegisterCenter
</code></pre><p><img src=/img/shenyu/register/register-nacos-admin-yml.png width=70% height=60%></p><h4 id=shenyu-client配置-4>shenyu-client配置</h4><p>下面展示的是<code>http</code>服务作为客户端接入到<code>ShenYu</code>网关时，通过<code>Nacos</code>方式注册配置信息。其他客户端接入时（<code>Dubbo</code>、 <code>Spring Cloud</code>等），配置方式同理。</p><ul><li>首先在 <code>pom</code>文件中加入相关的依赖：</li></ul><pre><code class=language-xml>        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
            &lt;artifactId&gt;shenyu-register-client-nacos&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src=/img/shenyu/register/register-nacos-client-pom.png width=70% height=60%></p><ul><li>然后在 <code>yml</code> 中配置注册方式为<code>nacos</code>, 并填写<code>nacos</code>服务地址和相关参数，还需要<code>Nacos</code>命名空间（需要和<code>shenyu-admin</code>端保持一致），IP（可不填，则自动获取本机ip）和端口，配置信息如下：</li></ul><pre><code class=language-yaml>shenyu:
  client:
    registerType: nacos
    serverLists: localhost:8848
    props:
      contextPath: /http
      appName: http
      port: 8188  
      isFull: false
      nacosNameSpace: ShenyuRegisterCenter
# registerType : 服务注册类型，填写 etcd
# serverList: 为etcd注册类型时，填写etcd地址，多个地址用英文分隔
# port: 你本项目的启动端口,目前springmvc/tars/grpc需要进行填写
# contextPath: 为你的这个mvc项目在shenyu网关的路由前缀，比如/order ，/product 等等，网关会根据你的这个前缀来进行路由.
# appName：你的应用名称，不配置的话，会默认取 `spring.application.name` 的值
# isFull: 设置true 代表代理你的整个服务，false表示代理你其中某几个controller；目前适用于springmvc/springcloud
# nacosNameSpace: nacos的命名空间
</code></pre><p><img src=/img/shenyu/register/register-nacos-client-yml.png width=70% height=60%></p><p>总结，本文主要介绍了如何将你的微服务（当前支持<code>Http</code>、 <code>Dubbo</code>、 <code>Spring Cloud</code>、 <code>gRPC</code>、 <code>Motan</code>、 <code>Sofa</code>、 <code>Tars</code>等协议）接入到<code>ShenYu</code>网关。介绍了注册中心的原理，<code>ShenYu</code>网关支持的注册中心有<code>Http</code>、<code>Zookeeper</code>、<code>Etcd</code>、<code>Consul</code>、<code>Nacos</code>等方式。还介绍了以<code>http</code>服务作为客户端接入到<code>ShenYu</code>网关时，使用不同方式注册配置信息。</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class="cate  -show-mobile"><h2 class=cate-title>Apache</h2><a class=link href=https://www.apache.org/>Foundation</a>
<a class=link href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=link href=https://www.apache.org/licenses/>License</a>
<a class=link href=https://www.apache.org/security/>Security</a>
<a class=link href=http://www.apache.org/events/current-event>Events</a>
<a class=link href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
<a class=link href=http://www.apache.org/foundation/thanks.html>Thanks</a></div><div class=cate><h2 class=cate-title>资源</h2><a class=link href=https://github.com/apache/incubator-shenyu>Github</a>
<a class=link href=/zh/projects/shenyu/overview/>文档</a></div><div class=cate><h2 class=cate-title>参与进来</h2><a class=link href=https://github.com/apache/incubator-shenyu/issues/new>反馈</a>
<a class=link href=/zh/community>社区</a>
<a class=link href=/zh/news>新闻</a></div><div class=cate><h2 class=cate-title>订阅邮件组</h2><a class=link href=mailto://dev-subscribe@shenyu.apache.org>订阅邮件</a>
<a class=link href=https://lists.apache.org/list.html?dev@shenyu.apache.org>邮件归档</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/WechatIMG127.jpeg><p class=qrcode-desc>微信公众号</p></div></div></div><div class=copyright><p>Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.
Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache EventMesh logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.
Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator.
Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects.
While incubation status is not necessarily a reflection of the completeness or stability of the code,
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></footer></body></html>
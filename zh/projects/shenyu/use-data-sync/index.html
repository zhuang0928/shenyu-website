<!doctype html><html><head><title>使用不同的数据同步策略 · ShenYu</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="zh"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link style=font-size:25px;margin-right:50px href=/zh/><img class=logo src=/img/logo/apache-shenyu.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=请输入要搜索的关键词><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/zh/projects/shenyu/download/><span>下载</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/shenyu/overview/><span>文档</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/community/code-conduct/><span>社区</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/news/><span>新闻</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/awesome/><span>Awesome</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/shenyu/use-data-sync/><span>English</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/zh/projects/shenyu/download/>下载</a>
<a class=navbar-item href=/zh/projects/shenyu/overview/>文档</a>
<a class=navbar-item href=/zh/community/code-conduct/>社区</a>
<a class=navbar-item href=/zh/news/>新闻</a>
<a class=navbar-item href=/zh/awesome/>Awesome</a>
<span class="navbar-item nav-hover"><a>Links</a><div class=dropdown-menu><a class=dropdown-item href=https://www.apache.org/>Apache Software Foundation</a>
<a class=dropdown-item href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=dropdown-item href=https://www.apache.org/>License</a>
<a class=dropdown-item href=http://www.apache.org/events/current-event>Apache Events</a>
<a class=dropdown-item href=https://www.apache.org/licenses/>Security</a>
<a class=dropdown-item href=http://www.apache.org/foundation/sponsorship.html>Sponsor and Donate</a>
<a class=dropdown-item href=http://www.apache.org/foundation/thanks.html>Thanks</a></div></span></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=请输入要搜索的关键词><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/shenyu/use-data-sync/>En</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="Apache ShenYu是一个异步的，高性能的，跨语言的，响应式的API网关。">Apache ShenYu(current)<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>主要项目</h4><ul class=list><li class=item><a href=/zh/projects/shenyu/overview>Apache ShenYu(current)</a></li><li class=item><a href=/zh/projects/shenyu-2.3.0/overview>Apache ShenYu(2.3.0)</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title=介绍 href=/zh/projects/shenyu/overview>介绍</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=设计文档>设计文档</a></div><ul class=leaf-section><li class=item><div class=link><a title=数据库设计 href=/zh/projects/shenyu/database-design>数据库设计</a></div></li><li class=item><div class=link><a title=配置流程设计 href=/zh/projects/shenyu/config>配置流程设计</a></div></li><li class=item><div class=link><a title=数据同步原理设计 href=/zh/projects/shenyu/data-sync>数据同步原理设计</a></div></li><li class=item><div class=link><a title=元数据设计 href=/zh/projects/shenyu/meta-data>元数据设计</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Admin使用文档>Admin使用文档</a></div><ul class=leaf-section><li class=item><div class=link><a title=字典配置 href=/zh/projects/shenyu/dictionary-management>字典配置</a></div></li><li class=item><div class=link><a title=插件配置模板 href=/zh/projects/shenyu/plugin-handle-explanation>插件配置模板</a></div></li><li class=item><div class=link><a title=选择器规则详解 href=/zh/projects/shenyu/selector-and-rule>选择器规则详解</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=用户文档>用户文档</a></div><ul class=leaf-section><li class=item><div class=link><a title=搭建ShenYu网关环境 href=/zh/projects/shenyu/shenyu-set-up>搭建ShenYu网关环境</a></div></li><li class=item><div class=link><a title=Http代理 href=/zh/projects/shenyu/http-proxy>Http代理</a></div></li><li class=item><div class=link><a title=Dubbo代理 href=/zh/projects/shenyu/dubbo-proxy>Dubbo代理</a></div></li><li class=item><div class=link><a title=SpringCloud代理 href=/zh/projects/shenyu/spring-cloud-proxy>SpringCloud代理</a></div></li><li class=item><div class=link><a title=Sofa代理 href=/zh/projects/shenyu/sofa-rpc-proxy>Sofa代理</a></div></li><li class=item><div class="link -current"><a title=数据同步策略 href=/zh/projects/shenyu/use-data-sync>数据同步策略</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=注册中心>注册中心</a></div><ul class=leaf-section><li class=item><div class=link><a title=设计 href=/zh/projects/shenyu/register-center-design>设计</a></div></li><li class=item><div class=link><a title=接入 href=/zh/projects/shenyu/register-center-access>接入</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=快速开始>快速开始</a></div><ul class=leaf-section><li class=item><div class=link><a title=Dubbo href=/zh/projects/shenyu/quick-start-dubbo>Dubbo</a></div></li><li class=item><div class=link><a title=Http href=/zh/projects/shenyu/quick-start-http>Http</a></div></li><li class=item><div class=link><a title=Grpc href=/zh/projects/shenyu/quick-start-grpc>Grpc</a></div></li><li class=item><div class=link><a title=SpringCloud href=/zh/projects/shenyu/quick-start-springcloud>SpringCloud</a></div></li><li class=item><div class=link><a title=Sofa href=/zh/projects/shenyu/quick-start-sofa>Sofa</a></div></li><li class=item><div class=link><a title=Tars href=/zh/projects/shenyu/quick-start-tars>Tars</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=插件集合>插件集合</a></div><ul class=leaf-section><li class=item><div class=link><a title=Divide插件 href=/zh/projects/shenyu/divide-plugin>Divide插件</a></div></li><li class=item><div class=link><a title=Dubbo插件 href=/zh/projects/shenyu/dubbo-plugin>Dubbo插件</a></div></li><li class=item><div class=link><a title="Spring Cloud插件" href=/zh/projects/shenyu/spring-cloud-plugin>Spring Cloud插件</a></div></li><li class=item><div class=link><a title=Sofa插件 href=/zh/projects/shenyu/sofa-plugin>Sofa插件</a></div></li><li class=item><div class=link><a title=RateLimiter插件 href=/zh/projects/shenyu/rate-limiter-plugin>RateLimiter插件</a></div></li><li class=item><div class=link><a title=Hystrix插件 href=/zh/projects/shenyu/hystrix-plugin>Hystrix插件</a></div></li><li class=item><div class=link><a title=Sentinel插件 href=/zh/projects/shenyu/sentinel-plugin>Sentinel插件</a></div></li><li class=item><div class=link><a title=Resilience4j插件 href=/zh/projects/shenyu/resilience4j-plugin>Resilience4j插件</a></div></li><li class=item><div class=link><a title=Monitor插件 href=/zh/projects/shenyu/monitor-plugin>Monitor插件</a></div></li><li class=item><div class=link><a title=Waf插件 href=/zh/projects/shenyu/waf-plugin>Waf插件</a></div></li><li class=item><div class=link><a title=Sign插件 href=/zh/projects/shenyu/sign-plugin>Sign插件</a></div></li><li class=item><div class=link><a title=Rewriter插件 href=/zh/projects/shenyu/rewrite-plugin>Rewriter插件</a></div></li><li class=item><div class=link><a title=Websocket支持 href=/zh/projects/shenyu/websocket-plugin>Websocket支持</a></div></li><li class=item><div class=link><a title=Context-path插件 href=/zh/projects/shenyu/context-path-plugin>Context-path插件</a></div></li><li class=item><div class=link><a title=Redirect插件 href=/zh/projects/shenyu/redirect-plugin>Redirect插件</a></div></li><li class=item><div class=link><a title=Logging插件 href=/zh/projects/shenyu/logging-plugin>Logging插件</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=开发者文档>开发者文档</a></div><ul class=leaf-section><li class=item><div class=link><a title=自定义filter href=/zh/projects/shenyu/custom-filter>自定义filter</a></div></li><li class=item><div class=link><a title=自定义插件 href=/zh/projects/shenyu/custom-plugin>自定义插件</a></div></li><li class=item><div class=link><a title=文件上传下载 href=/zh/projects/shenyu/file-and-image>文件上传下载</a></div></li><li class=item><div class=link><a title=自定义解析IP与host href=/zh/projects/shenyu/custom-parsing-ip-and-host>自定义解析IP与host</a></div></li><li class=item><div class=link><a title=自定义返回结果 href=/zh/projects/shenyu/custom-result>自定义返回结果</a></div></li><li class=item><div class=link><a title=自定义签名插件算法与验证 href=/zh/projects/shenyu/custom-sign-algorithm>自定义签名插件算法与验证</a></div></li><li class=item><div class=link><a title=多语言http客户端接入 href=/zh/projects/shenyu/developer-shenyu-client>多语言http客户端接入</a></div></li><li class=item><div class=link><a title=线程模型 href=/zh/projects/shenyu/thread>线程模型</a></div></li><li class=item><div class=link><a title=shenyu调优 href=/zh/projects/shenyu/shenyu-optimize>shenyu调优</a></div></li></ul></li><li class=item><div class=link><a title=文档下载 href=/zh/projects/shenyu/download>文档下载</a></div></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>使用不同的数据同步策略</h1><a class="edit-button -hidden-mobile" href=https://github.com/apache/incubator-shenyu-website/edit/main/content/zh/projects/shenyu/use-data-sync/index.md>编辑</a></div><div class=meta>更新时间: 2021-07-04</div></div><article class=typo><h2 id=说明>说明</h2><ul><li><p>数据同步是指将 <code>shenyu-admin</code> 配置的数据，同步到 <code>ShenYu</code> 集群中的JVM内存里面，是网关高性能的关键。</p></li><li><p>实现原理，请看：<a href=../data-sync>数据同步</a>。</p></li><li><p>文中所说的网关，是指你搭建的网关环境，请看：<a href=../shenyu-set-up>搭建环境</a>。</p></li></ul><h2 id=websocket同步-默认方式-推荐>websocket同步（默认方式，推荐）</h2><ul><li><p>网关配置（记得重启）</p><ul><li>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</li></ul><pre><code class=language-xml>&lt;!--shenyu data sync start use websocket--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
  &lt;artifactId&gt;shenyu-spring-boot-starter-sync-data-websocket&lt;/artifactId&gt;
  &lt;version&gt;${last.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul><li>在 springboot的 yml 文件中进行如下配置:</li></ul><pre><code class=language-yaml>shenyu:
  sync:
      websocket :
           urls: ws://localhost:9095/websocket
#urls:是指 shenyu-admin的地址，如果有多个，请使用（,）分割.
</code></pre><ul><li>shenyu-admin 配置，或在 shenyu-admin 启动参数中设置 <code>--shenyu.sync.websocket=''</code>，然后重启服务。</li></ul><pre><code class=language-yaml>shenyu:
  sync:
     websocket:
</code></pre><ul><li><p>当建立连接以后会全量获取一次数据，以后的数据都是增量的更新与新增，性能好。</p></li><li><p>支持断线重连 （默认30秒）。</p></li></ul><h2 id=zookeeper同步>zookeeper同步</h2><ul><li><p>网关配置（记得重启）</p></li><li><p>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</p></li></ul><pre><code class=language-xml>&lt;!--shenyu data sync start use zookeeper--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
    &lt;artifactId&gt;shenyu-spring-boot-starter-sync-data-zookeeper&lt;/artifactId&gt;
    &lt;version&gt;${last.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul><li>在 springboot的 yml 文件中进行如下配置:</li></ul><pre><code class=language-yaml>shenyu:
  sync:
    zookeeper:
      url: localhost:2181
      sessionTimeout: 5000
      connectionTimeout: 2000
      #url: 配置成你的zk地址，集群环境请使用（,）分隔
</code></pre><ul><li>shenyu-admin 配置, 或在 shenyu-admin 启动参数中设置 <code>--shenyu.sync.zookeeper.url='你的地址'</code>,然后重启服务。</li></ul><pre><code class=language-yaml>shenyu:
sync:
zookeeper:
    url: localhost:2181
    sessionTimeout: 5000
    connectionTimeout: 2000
</code></pre></li><li><p>使用zookeeper同步机制也是非常好的,时效性也高，我们生产环境使用的就是这个，但是也要处理zk环境不稳定，集群脑裂等问题.</p></li></ul><h2 id=http长轮询同步>http长轮询同步</h2><ul><li><p>网关配置（记得重启）</p><ul><li>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</li></ul><pre><code class=language-xml>&lt;!--shenyu data sync start use http--&gt;
&lt;dependency&gt;
   &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
    &lt;artifactId&gt;shenyu-spring-boot-starter-sync-data-http&lt;/artifactId&gt;
    &lt;version&gt;${last.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul><li>在 springboot的 yml 文件中进行如下配置:</li></ul><pre><code class=language-yaml>shenyu:
  sync:
      http:
           url: http://localhost:9095
#url: 配置成你的 shenyu-admin 的 ip 与端口地址，多个admin集群环境请使用（,）分隔。
</code></pre><ul><li>shenyu-admin 配置, 或在 shenyu-admin 启动参数中设置 <code>--shenyu.sync.http=''</code>,然后重启服务。</li></ul><pre><code class=language-yaml>shenyu:
  sync:
     http:
</code></pre><ul><li><p>http长轮询使得网关很轻量，时效性略低。</p></li><li><p>其根据分组key来拉取，如果数据量过大，过多，会有一定的影响。 什么意思呢？就是一个组下面的一个小地方更改，会拉取整个的组数据。</p></li><li><p>在shenyu-admin 集群时候，可能会有bug。</p></li></ul><h2 id=nacos同步>nacos同步</h2><ul><li><p>网关配置（记得重启）</p></li><li><p>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</p></li></ul><pre><code class=language-xml>&lt;!--shenyu data sync start use nacos--&gt;
  &lt;dependency&gt;
       &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
        &lt;artifactId&gt;shenyu-spring-boot-starter-sync-data-nacos&lt;/artifactId&gt;
        &lt;version&gt;${last.version}&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre><ul><li>在 springboot的 yml 文件中进行如下配置:</li></ul><pre><code class=language-yaml>shenyu:
  sync:
     nacos:
          url: localhost:8848
          namespace: 1c10d748-af86-43b9-8265-75f487d20c6c
          acm:
            enabled: false
            endpoint: acm.aliyun.com
            namespace:
            accessKey:
            secretKey:
#url: 配置成你的nacos地址，集群环境请使用（,）分隔。
# 其他参数配置，请参考naocs官网。
</code></pre><ul><li>shenyu-admin 配置, 或在 shenyu-admin 启动参数中使用 <code>--</code> 的方式一个一个传值</li></ul><p><pre><code class=language-yaml>shenyu:
sync:
nacos:
 url: localhost:8848
 namespace: 1c10d748-af86-43b9-8265-75f487d20c6c
 acm:
   enabled: false
   endpoint: acm.aliyun.com
   namespace:
   accessKey:
   secretKey:
</code></pre></li></ul></p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class="cate  -show-mobile"><h2 class=cate-title>Apache</h2><a class=link href=https://www.apache.org/>Foundation</a>
<a class=link href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=link href=https://www.apache.org/licenses/>License</a>
<a class=link href=https://www.apache.org/security/>Security</a>
<a class=link href=http://www.apache.org/events/current-event>Events</a>
<a class=link href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
<a class=link href=http://www.apache.org/foundation/thanks.html>Thanks</a></div><div class=cate><h2 class=cate-title>资源</h2><a class=link href=https://github.com/apache/incubator-shenyu>Github</a>
<a class=link href=/zh/projects/shenyu/overview/>文档</a>
<a class=link href=mailto://dev-subscribe@shenyu.apache.org>订阅邮件</a>
<a class=link href=https://lists.apache.org/list.html?dev@shenyu.apache.org>邮件归档</a></div><div class=cate><h2 class=cate-title>参与进来</h2><a class=link href=https://github.com/apache/incubator-shenyu/issues/new>反馈</a>
<a class=link href=/zh/community>社区</a>
<a class=link href=/zh/news>新闻</a></div></div></div><div class=copyright><p>Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.
Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache EventMesh logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.
Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator.
Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects.
While incubation status is not necessarily a reflection of the completeness or stability of the code,
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></footer></body></html>
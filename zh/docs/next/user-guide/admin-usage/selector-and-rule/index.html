<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Apache ShenYu (Incubating) Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Apache ShenYu (Incubating) Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache ShenYu (Incubating)" href="/zh/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/zh/news/rss.xml" title="Apache ShenYu (Incubating) Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/news/atom.xml" title="Apache ShenYu (Incubating) Blog Atom Feed"><title data-react-helmet="true">选择器和规则管理 | Apache ShenYu (Incubating)</title><meta data-react-helmet="true" property="og:url" content="https://shenyu.apache.org//zh/docs/next/user-guide/admin-usage/selector-and-rule"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="选择器和规则管理 | Apache ShenYu (Incubating)"><meta data-react-helmet="true" name="description" content="选择器和规则管理"><meta data-react-helmet="true" property="og:description" content="选择器和规则管理"><meta data-react-helmet="true" name="keywords" content="选择器,规则"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://shenyu.apache.org//zh/docs/next/user-guide/admin-usage/selector-and-rule"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//docs/next/user-guide/admin-usage/selector-and-rule" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//zh/docs/next/user-guide/admin-usage/selector-and-rule" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//docs/next/user-guide/admin-usage/selector-and-rule" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://NVVPQWV3R7-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.0743d29d.css">
<link rel="preload" href="/zh/assets/js/runtime~main.0c9f3217.js" as="script">
<link rel="preload" href="/zh/assets/js/main.fd04b409.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">⭐️ &nbsp; If you like Apache ShenYu (Incubating), give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/incubator-shenyu">GitHub</a></div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">×</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo.png" alt="Apache ShenYu Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/logo.png" alt="Apache ShenYu Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/zh/docs/next/index">文档</a><a class="navbar__item navbar__link" href="/zh/community/subscribe-email">社区</a><a class="navbar__item navbar__link" href="/zh/news">新闻</a><a class="navbar__item navbar__link" href="/zh/blog">博客</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__item navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/zh/docs/next/index">当前版本</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/docs/next/user-guide/admin-usage/selector-and-rule">当前版本</a></li><li><a class="dropdown__link" href="/zh/docs/user-guide/admin-usage/selector-and-rule">2.4.0</a></li><li><a class="dropdown__link" href="/zh/docs/2.3.0/index">2.3.0</a></li><li><a class="dropdown__link" href="/zh/versions">All versions</a></li></ul></div><a href="https://github.com/apache/incubator-shenyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/next/user-guide/admin-usage/selector-and-rule" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/next/user-guide/admin-usage/selector-and-rule" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/zh/docs/next/index">Apache ShenYu 介绍</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">设计文档</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">运维部署</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">快速开始</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">用户指南</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Admin使用</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/admin-usage/authority-management">Authority Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/admin-usage/dictionary-management">字典管理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/admin-usage/plugin-handle-explanation">插件配置</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/zh/docs/next/user-guide/admin-usage/selector-and-rule">选择器和规则管理</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">属性配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/dubbo-proxy">Dubbo服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/grpc-proxy">gRPC服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/http-proxy">Http服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/motan-proxy">Motan服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/register-center-access">客户端接入配置</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/sofa-rpc-proxy">Sofa服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/spring-cloud-proxy">Spring Cloud服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/tars-proxy">Tars服务接入</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/next/user-guide/use-data-sync">数据同步配置</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">插件集合</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">开发者文档</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/next/download">下载</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/next/release-notes">版本发布</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Apache ShenYu (Incubating) <b>当前版本</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/zh/docs/user-guide/admin-usage/selector-and-rule">latest version</a></b> (2.4.0).</div></div><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 当前版本</span><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">选择器和规则管理</h1></header><p>本文档将介绍<code>Apache ShenYu</code>后台管理系统中选择器和规则的使用，关于选择器和规则的概念及设计请参考 <a href="/zh/docs/next/user-guide/flow-control">流量控制</a>。</p><p>请参考运维部署的内容，选择一种方式启动<code>shenyu-admin</code>。比如，通过 <a href="/zh/docs/next/deployment/deployment-local">本地部署</a> 启动<code>Apache ShenYu</code>后台管理系统。 启动成功后，可以直接访问 http://localhost:9095 ，默认用户名和密码分别为: <code>admin</code> 和 <code>123456</code>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="选择器"></a>选择器<a class="hash-link" href="#选择器" title="Direct link to heading">#</a></h2><p>在插件列表中展示了当前的所有插件，可以给每个插件添加选择器和规则：</p><img src="/img/shenyu/basicConfig/pluginHandle/selector_example.png" width="80%" height="50%"><p>例如，给<code>divide</code>插件添加选择器：</p><img src="/img/shenyu/basicConfig/pluginHandle/selector_add.png" width="80%" height="80%"><ul><li><p>选择器详解：</p><ul><li>名称：给选择器取一个名字。</li><li>类型：自定义流量(<code>custom flow</code>) 或 全流量(<code>full flow</code>)。自定义流量就是请求会走下面的匹配方式与条件。全流量则不走。</li><li>匹配方式：<code>and</code>或者 <code>or</code> 是指下面多个条件是按照 并(<code>and</code>) 还是 或(<code>or</code>) 的方式来组合。</li><li>条件：<ul><li><code>uri</code>：根据 <code>uri</code> 的方式来筛选流量，<code>match</code> 的方式支持模糊匹配（<code>/**</code>）</li><li><code>header</code>：根据请求头里面的字段来筛选流量。</li><li><code>query</code>：根据 <code>uri</code> 的查询条件来进行筛选流量。</li><li><code>ip</code>：根据请求的真实 <code>ip</code> 来筛选流量。</li><li><code>host</code>：根据请求的真实 <code>host</code> 来筛选流量。</li><li><code>post</code>：不建议使用。</li><li><code>cookie</code>：根据请求的 <code>cookie</code> 来筛选流量。</li><li><code>req_method</code>：根据请求的 <code>req_method</code> 来筛选流量。</li><li>条件匹配：<ul><li><code>match</code>：模糊匹配，建议和<code>uri</code>条件搭配，支持 <code>restful</code> 风格的匹配。（<code>/test/**</code>）</li><li><code>=</code>：前后值相等，才能匹配。</li><li><code>regEx</code>：正则匹配，表示前面一个值去匹配后面的正则表达式。</li><li><code>like</code>：字符串模糊匹配。</li><li><code>contains</code>：请求包含指定的值，才能匹配。</li><li><code>SpEl</code>：<code>SpEl</code>表达式匹配。</li><li><code>Groovy</code>：通过<code>Groovy</code>脚本语言匹配。</li><li><code>TimeBefore</code>：指定时间之前。</li><li><code>TimeAfter</code>：指定时间之后。</li></ul></li></ul></li><li>继续后续选择器：后续选择器还是否执行。</li><li>是否开启：打开才会生效。</li><li>打印日志：打开时，当匹配上的时候，会打印匹配日志。</li><li>执行顺序：当多个选择器的时候，执行顺序小的优先执行，值越小优先级越高。</li><li>处理：即<code>handle</code>字段，在 <a href="/zh/docs/next/user-guide/admin-usage/plugin-handle-explanation">插件处理管理</a> 中进行设置。作用是：当请求流量匹配上该选择器时，做什么样的处理操作。</li></ul></li><li><p>上述图片中表示: 当请求的 <code>uri</code> 前缀是 <code>/http</code>，会转发到 <code>127.0.0.1:8080</code> 这个服务上。</p></li><li><p>选择器建议：可以通过设置 <code>uri</code> 条件， <code>match</code> 前缀（<code>/contextPath</code>）匹配，进行第一道流量筛选。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="规则"></a>规则<a class="hash-link" href="#规则" title="Direct link to heading">#</a></h2><img src="/img/shenyu/basicConfig/pluginHandle/rule_handle.png" width="80%" height="80%"><ul><li><p>当流量经过选择器匹配成功之后，会进入规则来进行最终的流量匹配。</p></li><li><p>规则是对流量最终执行逻辑的确认。</p></li><li><p>规则详解：</p><ul><li>名称：给规则取一个名字。</li><li>匹配方式：<code>and</code> 或者 <code>or</code> 是指下面多个条件的组合方式。</li><li>条件：<ul><li><code>uri</code>：根据 <code>uri</code> 的方式来筛选流量，<code>match</code> 的方式支持模糊匹配（<code>/**</code>）</li><li><code>header</code>：根据请求头里面的字段来筛选流量。</li><li><code>query</code>：根据 <code>uri</code> 的查询条件来进行筛选流量。</li><li><code>ip</code>：根据请求的真实 <code>ip</code> 来筛选流量。</li><li><code>host</code>：根据请求的真实 <code>host</code> 来筛选流量。</li><li><code>post</code>：不建议使用。</li><li><code>cookie</code>：根据请求的 <code>cookie</code> 来筛选流量。</li><li><code>req_method</code>：根据请求的 <code>req_method</code> 来筛选流量。</li><li>条件匹配：<ul><li><code>match</code>：模糊匹配，建议和<code>uri</code>条件搭配，支持 <code>restful</code> 风格的匹配。（<code>/test/**</code>）</li><li><code>=</code>：前后值相等，才能匹配。</li><li><code>regEx</code>：正则匹配，表示前面一个值去匹配后面的正则表达式。</li><li><code>like</code>：字符串模糊匹配。</li><li><code>contains</code>：请求包含指定的值，才能匹配。</li><li><code>SpEl</code>：<code>SpEl</code>表达式匹配。</li><li><code>Groovy</code>：通过<code>Groovy</code>脚本语言匹配。</li><li><code>TimeBefore</code>：指定时间之前。</li><li><code>TimeAfter</code>：指定时间之后。</li></ul></li></ul></li><li>是否开启：打开才会生效。</li><li>打印日志：打开时，当匹配上的时候，才会打印匹配日志。</li><li>执行顺序：当多个规则的时候，执行顺序小的优先执行。</li><li>处理：即<code>handle</code>字段，在 <a href="/zh/docs/next/user-guide/admin-usage/plugin-handle-explanation">插件处理管理</a> 中进行设置。每个插件的规则处理不一样，具体请查看每个对应插件的处理。</li></ul></li><li><p>上图表示：当 <code>uri</code> 等于  <code>/http/order/save</code> 的时候能够匹配上该规则，就会执行该规则中，负载策略是 <code>random</code>，重试次数是 <code>3</code> 等处理操作。</p></li><li><p>规则建议：可以<code>uri</code> 条件， <code>match</code> 最真实的<code>uri路径</code>，进行流量的最终筛选 。</p></li></ul><p>联合选择器，我们来表述一下：当一个请求的 <code>uri</code> 为 <code>/http/order/save</code>，会通过 <code>random</code> 的方式，转发到 <code>127.0.0.1:8080</code> 机器上。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="条件详解"></a>条件详解<a class="hash-link" href="#条件详解" title="Direct link to heading">#</a></h2><p>对选择器和规则中的条件设置再次进行解释。</p><ul><li><p><code>uri</code> 匹配 （推荐）</p><ul><li><p><code>uri</code> 匹配是根据你请求路径中的 <code>uri</code> 来进行匹配，在接入网关的时候，前端几乎不用做任何更改。</p></li><li><p>当使用 <code>match</code> 方式匹配时候，同 <code>springmvc</code> 模糊匹配原理相同。</p></li><li><p>在选择器中，推荐使用 <code>uri</code> 中的前缀来进行匹配，而在规则中，则使用具体路径来进行匹配。</p></li><li><p>该匹配方式的时候，在匹配字段名称可以任意填写，匹配字段值需要正确填写。</p></li></ul></li><li><p><code>header</code> 匹配</p><ul><li><code>header</code> 是根据你的 <code>http</code> 请求头中的字段值来匹配。</li></ul></li><li><p><code>query</code> 匹配</p><ul><li><p>这个是根据你的 <code>uri</code> 中的查询参数来进行匹配，比如 <code>/test?a=1&amp;b=2</code> ，那么可以选择该匹配方式。</p></li><li><p>上述就可以新增一个条件，选取 <code>query</code> 方式, <code>a = 1</code>。</p></li></ul></li><li><p><code>ip</code>匹配</p><ul><li><p>这个是根据 <code>http</code> 调用方的 <code>ip</code> 来进行匹配。</p></li><li><p>尤其是在 <code>waf</code> 插件里面，如果发现一个 <code>ip</code>地址有攻击，可以新增一条匹配条件，填上该 <code>ip</code>，拒绝该 <code>ip</code> 的访问。</p></li><li><p>如果在 <code>Apache ShenYu</code> 前面使用了 <code>nginx</code> 代理，为了获取正确的 <code>ip</code>，可以参考 <a href="/zh/docs/next/developer/custom-parsing-ip-and-host">自定义解析IP与Host</a></p></li></ul></li><li><p><code>host</code> 匹配</p><ul><li><p>这个是根据 <code>http</code> 调用方的 <code>host</code> 来进行匹配。</p></li><li><p>尤其是在 <code>waf</code> 插件里面，如果发现一个 <code>host</code> 地址有攻击，可以新增一条匹配条件，填上该 <code>host</code>，拒绝该 <code>host</code> 的访问。</p></li><li><p>如果在 <code>Apache ShenYu</code> 前面使用了 <code>nginx</code> 代理，为了获取正确的 <code>host</code>，可以参考 <a href="/zh/docs/next/developer/custom-parsing-ip-and-host">自定义解析IP与Host</a></p></li></ul></li><li><p><code>post</code> 匹配</p><ul><li>不推荐使用。</li></ul></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/apache/incubator-shenyu-website/edit/main/i18n/zh/docusaurus-plugin-content-docs/current/user-guide/admin-usage/selector-and-rule.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑本文档</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/docs/next/user-guide/admin-usage/plugin-handle-explanation"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« 插件配置</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/docs/next/user-guide/property-config/admin-property-config"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">Admin属性配置 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#选择器" class="table-of-contents__link">选择器</a></li><li><a href="#规则" class="table-of-contents__link">规则</a></li><li><a href="#条件详解" class="table-of-contents__link">条件详解</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ShenYu</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/index">文档</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/news">新闻</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog">博客</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-shenyu/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>版本<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/community/subscribe-email">社区</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-shenyu" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/incubator-shenyu/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">订阅邮件组</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/community/subscribe-email">如何定阅</a></li><li class="footer__item"><a href="mailto://dev-subscribe@shenyu.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>订阅邮件<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://lists.apache.org/list.html?dev@shenyu.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>邮件归档<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div><img style="height:50px" alt="Apache Software Foundation" src="/img/incubator-logo.png"><p style="color:#ffffffcf;font-size:14px;text-align:left">Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
      <p style="color:white;font-size:14px;"> Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0. Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache ShenYu logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.</p>
      <div></div></div></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.0c9f3217.js"></script>
<script src="/zh/assets/js/main.fd04b409.js"></script>
</body>
</html>